<h1>Welcome, <%= user.nickname || user.email %>!</h1>
<a href="/profile">
  <img src="<%= user.profilePic %>" alt="Profile" width="40" height="40" style="border-radius: 50%; vertical-align: middle;">
</a>

<br>

<h2>Latest Posts</h2>

<% posts.forEach(post => { %>
  <div class="post-card">

    <div class="user-info">
      <% if (post.userId && post.userId.profilePic) { %>
        <img src="<%= post.userId.profilePic.startsWith('/') ? post.userId.profilePic : '/uploads/' + post.userId.profilePic %>" 
             alt="profile" width="40" height="40" style="border-radius: 50%;">
        <strong><%= post.userId.nickname || 'No name' %></strong>
      <% } else { %>
        <img src="/default_profile.jpg" width="40" height="40" style="border-radius: 50%;">
        <strong>Unknown User</strong>
      <% } %>
    </div>

    <div class="post-image">
      <img src="/uploads/<%= post.image %>" alt="post" style="max-width: 100%; height: auto;">
    </div>

    <div class="caption">
      <p><%= post.caption %></p>
      <small><%= new Date(post.createdAt).toLocaleString() %></small>
    </div>

    <% // NEW FEATURE: Conditionally display delete button %>
    <% if (post.userId && user && post.userId._id.toString() === user._id.toString()) { %>
      <div class="post-actions">
        <form action="/posts/delete/<%= post._id %>" method="POST" onsubmit="return confirm('Are you sure you want to delete this post?');">
          <button type="submit" style="background-color: #dc3545; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer;">Delete</button>
        </form>
      </div>
    <% } %>
  </div>
  <hr>
<% }) %>

<a href="/posts/create" class="plus-icon">+</a>

<br>

<a href="/logout">Logout</a>
